info:
  name: Validate Pet Vaccine - External Libraries
  type: http
  seq: 7

http:
  method: POST
  url: "{{baseUrl}}"
  body:
    type: json
    data: |
      {
        "pets": [
          {
            "id": "pet_002",
            "name": "Jerry",
            "age": 4,
            "vaccinated": true,
            "tags": ["friendly", "energetic"]
          },
          {
            "id": "pet_005",
            "name": "Sam",
            "age": 2,
            "vaccinated": false,
            "tags": ["quiet", "food-motivated"]
          }
        ]
      }
  auth: inherit

runtime:
  scripts:
    - type: tests
      code: |-
        const { z } = require("zod");

        const response = res.getBody();

        const PetSchema = z.object({
          id: z.string().startsWith("pet_"),
          name: z.string(),
          age: z.number().int().nonnegative(),
          vaccinated: z.boolean(),
          tags: z.array(z.string())
        });

        const PetsResponseSchema = z.object({
          pets: z.array(PetSchema)
        });

        test("Valid response structure for pets", () => {
          PetsResponseSchema.parse(response);
        });
        test("All pets must be vaccinated", () => {
          const unvaccinated = response.pets.filter(pet => !pet.vaccinated);
          if (unvaccinated.length > 0) {
            throw new Error(`Found unvaccinated pets: ${unvaccinated.map(p => p.name).join(", ")}`);
          }
        });

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

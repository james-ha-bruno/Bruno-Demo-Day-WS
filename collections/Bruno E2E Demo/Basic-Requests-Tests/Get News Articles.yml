info:
  name: Get News Articles
  type: http
  seq: 2
  tags:
    - demo

http:
  method: GET
  url: https://newsapi.org/v2/everything?q=tesla&sortBy=publishedAt&from={{validDate}}
  params:
    - name: q
      value: tesla
      type: query
    - name: sortBy
      value: publishedAt
      type: query
    - name: from
      value: "{{validDate}}"
      type: query
    - name: from
      value: 2025-10-01
      type: query
      disabled: true
  auth:
    type: apikey
    key: apiKey
    value: "{{$secrets.azure-keys.news-api-key}}"
    placement: query

runtime:
  scripts:
    - type: before-request
      code: |-
        // Get today's date
        const today = new Date();

        // Subtract 28 days
        const pastDate = new Date(today);
        pastDate.setDate(today.getDate() - 28);

        // Format as YYYY-MM-DD
        const formatted = pastDate.toISOString().split('T')[0];

        // Save as a Bruno variable
        bru.setVar('validDate', formatted);

        // Optional: log to console
        console.log('Date 28 days ago:', formatted);
  assertions:
    - expression: res.status
      operator: eq
      value: "200"
    - expression: res.body
      operator: isJson

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5
